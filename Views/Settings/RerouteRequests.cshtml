@model HRViabilityPortal.ViewModels.RerouteRequestsViewModel
@using PagedList.Mvc;

@{
    ViewBag.Title = "Reassign Requests";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@using (Html.BeginForm("RerouteRequests", "Settings", FormMethod.Post))

{
    <!-- BEGIN HIDDEN FIELDS AREA -->
    @Html.HiddenFor(m => m.EventCommand)
    @Html.HiddenFor(m => m.Mode)
    @Html.HiddenFor(m => m.EventArgument)
    <!-- END HIDDEN FIELDS AREA -->
    <!--start Loading panel-->
    <div id="loading" class="modal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class=" modal-title">Loading... </h4>
                </div>
                <div class=" modal-body">
                    <div class=" progress progress-striped active">
                        <div class="progress-bar" style="width:100%"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--start Loading panel-->
    <div class="content-wrapper">
        <section class="content">
            <!-- ** BEGIN MESSAGE AREA -->
            <div class="row">
                <div class="col-xs-12">
                    @if (!Model.IsValid)
                    {
                        <div class="alert alert-danger  alert-dismissable" role="alert">
                            <button type="button" class="close"
                                    data-dismiss="alert">
                                <span aria-hidden="true">
                                    &times;
                                </span>
                                <span class="sr-only">Close</span>
                            </button>
                            @Html.ValidationSummary(false)
                        </div>
                    }
                    @if (TempData["Msg"] != null)
                    {
                        <div class="alert alert-dismissable alert-success">
                            <button type="button" class="close" data-dismiss="alert">
                                x
                            </button>
                            @TempData["Msg"].ToString()
                        </div>
                    }

                </div>
            </div>
            <!-- ** END MESSAGE AREA -->
            <!-- add new comment to index file -->
            @if (Model.IsStep1)
            {
                <!-- ** BEGIN SEARCH AREA ** -->
                
                <div class="container">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="panel panel-color panel-primary">
                                <div class="panel-heading">
                                    <h3 class="panel-title">Request Rerouting Initiation</h3>
                                </div>
                                <div class="panel-body">
                                    <div class="col-md-6">
                                        <div class="form-group m-b-0">
                                            <label class="control-label">Request Reference Number:</label>
                                            @Html.TextBoxFor(m => m.SearchEntity.requestReferenceNumber, new { @class = "form-control"})
                                        </div>                                       
                                        <br />
                                        <br />
                                        <br /><br />
                                        <div class="panel-footer">
                                            <div class="row">
                                                <div class="col-sm-12">
                                                    <button id="btnSave"
                                                            class="btn btn-sm btn-primary pull-right"
                                                            data-pdsa-action="proceed">
                                                        <i class="glyphicon glyphicon-search"></i>
                                                        &nbsp;Fetch Details
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- ** END SEARCH AREA ** -->
            }

            @if (Model.IsStep2)
            {
                <!-- ** BEGIN SEARCH AREA ** -->
               
                <div class="container">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="panel panel-color panel-success">
                                <div class="panel-heading">
                                    <h3 class="panel-title">Request Details</h3>
                                </div>
                                <div class="panel-body">
                                    <div class="col-md-6">
                                        <div class="form-group m-b-0">
                                            <label class="control-label">Reference Number:</label>
                                            @Html.TextBoxFor(m => m.Entity.requestReferenceNumber, new { @class = "form-control", @readonly = "readonly" })
                                        </div>
                                        <br />
                                        <div class="form-group m-b-0">
                                            <label class="control-label">Staff ID:</label>
                                            @Html.TextBoxFor(m => m.Entity.staffId, new { @class = "form-control", @readonly = "readonly" })
                                        </div>
                                        <br />
                                        <div class="form-group m-b-0">
                                            <label class="control-label">Account Number:</label>
                                            @Html.TextBoxFor(m => m.Entity.accountNumber, new { @class = "form-control", @readonly = "readonly" })
                                        </div>
                                        <br />
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group m-b-0">
                                            <label class="control-label">Account Name:</label>
                                            @Html.TextBoxFor(m => m.Entity.accountName, new { @class = "form-control", @readonly = "readonly" })
                                        </div>
                                        <br />
                                        <div class="form-group m-b-0">
                                            <label class="control-label">Facility Type:</label>
                                            @Html.TextBoxFor(m => m.Entity.facilityName, new { @class = "form-control", @readonly = "readonly" })
                                        </div>
                                        <br />
                                        <div class="form-group m-b-0">
                                            <label class="control-label">Facility Amount:</label>
                                            @Html.TextBoxFor(m => m.Entity.amountRequested, new { @class = "form-control", @readonly = "readonly" })
                                        </div>
                                        <br />
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group m-b-0">
                                            <label class="control-label">Branch Code:</label>
                                            @Html.TextBoxFor(m => m.Entity.branchCode, new { @class = "form-control", @readonly = "readonly" })
                                        </div>
                                        <br />
                                        <div class="form-group m-b-0">
                                            <label class="control-label">Branch/Unit/Department:</label>
                                            @Html.TextBoxFor(m => m.Entity.department, new { @class = "form-control", @readonly = "readonly" })
                                        </div>
                                        <br />
                                        <div class="form-group m-b-0">
                                            <label class="control-label">Date Of Request:</label>
                                            @Html.TextBoxFor(m => m.Entity.requestDate, new { @class = "form-control", @readonly = "readonly" })
                                        </div>
                                        <br />
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group m-b-0">
                                            <label class="control-label">New Branch To Be Rerouted To:</label>
                                            @Html.DropDownListFor(m => m.newBranch, new SelectList(Model.Branches, "Value", "Text"), new { @class = "form-control" })
                                        </div>
                                        <br />
                                    </div>
                                    <div class="col-md-6">
                                        <div class="panel-footer">
                                            <div class="row">
                                                <button id="btnSave"
                                                        class="btn btn-sm btn-primary pull-right"
                                                        data-pdsa-action="submit">
                                                    <i class="glyphicon glyphicon-floppy-save"></i>
                                                    &nbsp;Submit
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ** END SEARCH AREA ** -->
            }

        </section>
    </div>



}

@section scripts
    {
    <script src="~/Content2/assets/plugins/timepicker/bootstrap-timepicker.js"></script>
    <script src="~/Content2/assets/plugins/bootstrap-colorpicker/js/bootstrap-colorpicker.min.js"></script>
    <script src="~/Content2/assets/plugins/bootstrap-datepicker/js/bootstrap-datepicker.min.js"></script>
    <script src="~/Content2/assets/plugins/bootstrap-maxlength/bootstrap-maxlength.min.js" type="text/javascript"></script>
    <script src="~/Content2/assets/plugins/bootstrap-touchspin/js/jquery.bootstrap-touchspin.min.js" type="text/javascript"></script>

    <link href="~/Content2/assets/plugins/bootstrap-sweetalert/sweet-alert.css" rel="stylesheet" type="text/css">

    <script src="~/Content2/assets/plugins/datatables/jquery.dataTables.min.js"></script>
    <script src="~/Content2/assets/plugins/datatables/dataTables.bootstrap.js"></script>
    <script src="~/Content2/assets/plugins/datatables/dataTables.buttons.min.js"></script>
    <script src="~/Content2/assets/plugins/datatables/buttons.bootstrap.min.js"></script>
    <script src="~/Content2/assets/plugins/datatables/jszip.min.js"></script>
    <script src="~/Content2/assets/plugins/datatables/pdfmake.min.js"></script>
    <script src="~/Content2/assets/plugins/datatables/vfs_fonts.js"></script>
    <script src="~/Content2/assets/plugins/datatables/buttons.html5.min.js"></script>
    <script src="~/Content2/assets/plugins/datatables/buttons.print.min.js"></script>
    <script src="~/Content2/assets/plugins/datatables/dataTables.fixedHeader.min.js"></script>
    <script src="~/Content2/assets/plugins/datatables/dataTables.keyTable.min.js"></script>
    <script src="~/Content2/assets/plugins/datatables/dataTables.responsive.min.js"></script>
    <script src="~/Content2/assets/plugins/datatables/responsive.bootstrap.min.js"></script>
    <script src="~/Content2/assets/plugins/datatables/dataTables.scroller.min.js"></script>

    <!-- jQuery  -->
    <script src="~/Content2/assets/js/jquery.min.js"></script>
    <script src="~/Content2/assets/js/bootstrap.min.js"></script>
    <script src="~/Content2/assets/js/modernizr.min.js"></script>
    <script src="~/Content2/assets/js/detect.js"></script>
    <script src="~/Content2/assets/js/fastclick.js"></script>
    <script src="~/Content2/assets/js/jquery.slimscroll.js"></script>
    <script src="~/Content2/assets/js/jquery.blockUI.js"></script>
    <script src="~/Content2/assets/js/waves.js"></script>
    <script src="~/Content2/assets/js/wow.min.js"></script>
    <script src="~/Content2/assets/js/jquery.nicescroll.js"></script>
    <script src="~/Content2/assets/js/jquery.scrollTo.min.js"></script>

    <!-- Sweet-Alert  -->
    <script src="~/Content2/assets/plugins/bootstrap-sweetalert/sweet-alert.min.js"></script>
    <script src="~/Content2/assets/pages/sweet-alert.init.js"></script>

    <script src="~/Content2/assets/js/app.js"></script>
    <script src="~/Content/MoneyUtil.js"></script>

    <script>
        $(document).ready(function () {
            $(document).ajaxStart(function () {
                $("#loading").show();
            });
            $(document).ajaxStop(function () {
                $("#loading").hide();
            });

            $("[data-pdsa-action]").on("click", function (e) {
                $("#loading").show();
                e.preventDefault();

                $("#EventCommand").val(
                    $(this).data("pdsa-action"));

                $("#EventArgument").val(
                    $(this).attr("data-pdsa-val"));

                if ($(this).data("pdsa-action") == "submit") {
                    //swal();
                    swal({
                        title: "Are You Sure You Want to Submit?",
                        text: "",
                        type: "success",
                        //timer: 5000,
                        showCancelButton: true,
                        showConfirmButton: true,
                        confirmButtonClass: "btn-success",
                        confirmButtonText: "Yes, Submit!",
                        cancelButtonText: "No, Cancel!",
                        closeOnConfirm: false
                    }, function (s) {
                        if (s) {
                            $("form").submit();
                            $.ajax({
                                type: frm.attr('method'),
                                url: frm.attr('action'),
                                data: frm.serialize(),
                                success: function (data) {
                                    console.log('Submission was successful.');
                                    console.log(data);
                                },
                                error: function (data) {
                                    console.log('An error occurred.');
                                    console.log(data);
                                },
                            });
                        }

                    });

                } else {
                    $("form").submit();
                }

                // $("form").submit();
                // $.ajax({
                //    type: frm.attr('method'),
                //    url: frm.attr('action'),
                //    data: frm.serialize(),
                //    success: function (data) {
                //        console.log('Submission was successful.');
                //        console.log(data);
                //    },
                //    error: function (data) {
                //        console.log('An error occurred.');
                //        console.log(data);
                //    },
                //});
                $("#loading").hide();
            });
        });
    </script>

    <script>
        $(document).ready(function () {
            $.noConflict();
            $('#viewHistory').DataTable({
                dom: 'Bfrtip',
                buttons: [
                    'csv', 'excel'
                ],
            });
        });
    </script>

    <script type="text/javascript" language="javascript">
        function validateInput(regexString) {
            var theEvent = window.event || event;
            var key = theEvent.keyCode || theEvent.which;
            if (key >= 46) {
                key = String.fromCharCode(key);
                var regex = new RegExp("^" + regexString + "$");
                if (!regex.test(key)) {
                    theEvent.returnValue = false;
                    if (theEvent.preventDefault) {
                        theEvent.preventDefault();
                    }
                }
            }
        }

    </script>

    <script type="text/javascript" language="javascript">
        function Comma(Num) {
            Num += '';
            Num = Num.replace(',', '');
            Num = Num.replace(',', '');
            Num = Num.replace(',', '');
            Num = Num.replace(',', '');
            Num = Num.replace(',', '');
            Num = Num.replace(',', '');
            x = Num.split('.');
            x1 = x[0];
            x2 = x.length > 1 ? '.' + x[1] : '';
            var rgx = /(\d+)(\d{3})/;
            while (rgx.test(x1))
                x1 = x1.replace(rgx, '$1' + ',' + '$2');
            return x1 + x2;
        }

        $("#amountRepatriated").keyup(function () {
            var amt = $("#amountRepatriated").val();
            $("#span1").css('color', 'green').text(toWords(amt) + "(" + formatMoney(amt) + ")");
            //document.getElementById('span1').innerHTML = toWords(amt)+"("+formatMoney(amt)+")";//print the output

        });

    </script>

    <script>
        $(document).ready(function () {
            $("#succ").fadeOut(4000);
            $("input[name='demo2']").TouchSpin({
                min: 0,
                max: 100,
                step: 0.1,
                decimals: 2,
                boostat: 5,
                maxboostedstep: 10,
                postfix: '%'
            });
            $(".vertical-spin").TouchSpin({
                verticalbuttons: true,
                verticalupclass: 'ion-plus-round',
                verticaldownclass: 'ion-minus-round'
            });
            $("[data-gijb-button]").on("click", function (e) {
                e.preventDefault();
                $("#EventCommand").val($(this).data("gijb-button"));
                $("#EventArgument").val($(this).data("gijb-val"));
                $("#Mode").val($(this).data("gijb-val"));

            });

            $(".vertical-spin").TouchSpin({
                verticalbuttons: true,
                verticalupclass: 'ion-plus-round',
                verticaldownclass: 'ion-minus-round'
            });

            $('#test').on('change', function () {
                alert("Hello");
            });
        });

    </script>

    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script type="text/javascript">
        $(function () {
            $("#subFixedOpt").change(function () {
                if ($(this).val() == "1") {
                    $("#subFixedAmount").removeAttr("disabled");
                    $("#subFixedAmount").focus();
                } else {
                    $("#subFixedAmount").attr("disabled", "disabled");
                }
            });
        });
    </script>

    <script>
        $(document).ready(function () {
            $("#merchantReq_merchantAccountNumber").on('change', function () {
                if (this.value.length = 10) {
                    $("#divLoading").show();
                    var option = {};
                    option.url = '@Url.Action("getaccountdetails", "Merchants")';
                    option.type = "POST";
                    option.data = JSON.stringify({ accountNo: $("#merchantReq_merchantAccountNumber").val() });
                    option.dataType = "json";
                    option.contentType = "application/json";
                    option.success = function(result2){

                    $("#merchantReq_merchantAccountName").val(result2.AccountName);

                     $("#divLoading").hide();
                        if (result2.AccountName == null) {
                            alert("Incoorect/Invalid Account Number Supplied!");
                            $("#divLoading").hide();
                        }
                    };

                    option.error = function () { alert("Error retrieving Account Details!"); };
                    $.ajax(option);
                }
            });
        });
    </script>

}